# Repo Manager - Документация проекта

## Описание
GUI приложение для управления Git репозиториями, написанное на Rust с использованием egui. Позволяет организовывать репозитории в workspace'ы, выполнять Git операции и отслеживать состояние репозиториев.

## Основные возможности
- **Ленивая загрузка workspace'ов** - загружаются только репозитории активного workspace
- **Запоминание последнего активного workspace** при перезапуске приложения
- **Поддержка множественных Git remotes** (не только origin)
- **Улучшенное отображение веток** с сортировкой по дате и скрытием дубликатов
- **Визуальные индикаторы ошибок** - красный восклицательный знак для проблемных репозиториев
- **Оптимизированные Git операции** с избеганием медленных сетевых операций

## Структура проекта

### Корневые файлы
- `Cargo.toml` - Конфигурация проекта и зависимости
- `README.md` - Основная документация проекта
- `LICENSE` - Лицензия проекта
- `.claude.md` - Данная документация структуры

### Директория `src/`
Основной код приложения, организованный в модули:

#### `src/main.rs`
**Назначение**: Точка входа в приложение
- Инициализация приложения MyApp
- Настройка eframe окна
- Основной цикл обработки событий UI
- Реализация trait eframe::App для MyApp

#### `src/lib.rs`
**Назначение**: Объявление модулей библиотеки
- Публичные экспорты всех модулей проекта

### Модуль `src/app/`
**Назначение**: Основная логика приложения

#### `src/app/mod.rs`
- Структура `MyApp` - главное состояние приложения
- Методы загрузки/сохранения конфигурации
- Инициализация Git коммуникации
- Ленивая загрузка workspace'ов (`load_workspace`, `switch_to_workspace`)
- Отслеживание ошибок репозиториев (`error_repos`)

#### `src/app/messages.rs`
- `AppMessage` - перечисление сообщений между потоками
- Обработка асинхронных операций
- Связь между UI и фоновыми Git операциями

#### `src/app/tree.rs`
- `TreeNode` - структура для представления дерева репозиториев
- `TreeBuilder` - построение иерархического дерева из списка репозиториев
- Сортировка и группировка репозиториев по директориям

#### `src/app/search.rs`
- `RepositorySearcher` - поиск Git репозиториев в файловой системе
- Рекурсивное сканирование директорий
- Фильтрация по типу директорий (исключение node_modules, target и т.д.)

### Модуль `src/config/`
**Назначение**: Управление конфигурацией приложения

#### `src/config/mod.rs`
- `Config` - структура конфигурации (workspace'ы, размеры окна, настройки)
- `ConfigManager` - загрузка и сохранение конфигурации
- Запоминание последнего активного workspace (`last_active_workspace_index`)
- Поддержка разных ОС (Windows, macOS, Linux)
- Обратная совместимость с legacy конфигурацией

### Модуль `src/git/`
**Назначение**: Работа с Git репозиториями

#### `src/git/mod.rs`
- Публичные экспорты всех Git модулей
- Точка входа для Git операций

#### `src/git/logic.rs`
- `GitInfo` - структура информации о репозитории (ветки, статус, коммиты)
- `GitMessage` - сообщения Git операций
- `get_git_info()` - получение информации о репозитории с оптимизациями
- Поддержка множественных remotes (`get_remotes()`)
- Умное отображение веток с сортировкой по дате
- Оптимизированная проверка ahead/behind без сетевых операций

#### `src/git/operations.rs`
- Синхронные Git операции: fetch, pull, push, reset, switch branch
- Умное переключение на remote ветки с созданием tracking веток
- Асинхронные версии операций с обновлением UI
- Обработка ошибок и retry логика с таймингом
- Интеграция с пулом соединений

#### `src/git/pool.rs`
- `PoolGuard` - ограничение количества одновременных Git операций
- Предотвращение перегрузки системы
- Таймауты для операций

### Модуль `src/logging/`
**Назначение**: Система логирования

#### `src/logging/mod.rs`
- `Logger` - централизованное логирование с ротацией
- `LogEntry` - структура записи лога с временными метками
- `LogLevel` - уровни логирования (Info, Warning, Error)
- Методы для подсчета ошибок и предупреждений

### Модуль `src/ui/`
**Назначение**: Пользовательский интерфейс

#### `src/ui/mod.rs`
- Публичные экспорты UI компонентов
- Единая точка доступа к UI элементам

#### `src/ui/components.rs`
- `Button` - универсальный билдер кнопок
- `ButtonBuilder` - Fluent API для настройки кнопок
- `ButtonStyle` - стили кнопок (Default, Primary, Danger, Success)
- `Icon` - утилиты для отображения иконок
- Функции обратной совместимости для старого API

#### `src/ui/icons.rs`
- `IconManager` - управление PNG иконками
- `IconType` - перечисление типов иконок
- Загрузка PNG из embedded ресурсов
- Fallback рендеринг пиксельных иконок при ошибках

### Модуль `src/workspace/`
**Назначение**: Управление workspace'ами и репозиториями

#### `src/workspace/mod.rs`
- `Workspace` - группа репозиториев с ленивой загрузкой
- `RepositoryState` - состояние отдельного репозитория
- Методы добавления/удаления репозиториев
- Отслеживание состояния загрузки (`is_loaded`, `mark_as_loaded`)
- Сериализация для сохранения конфигурации

### Директория `assets/`
**Назначение**: Статические ресурсы

#### `assets/png/`
Иконки в формате PNG:
- `check.png` - галочка для подтверждения действий
- `cross.png` - крестик для отмены/ошибок  
- `edit.png` - карандаш для редактирования
- `folder.png` - папка для директорий
- `info.png` - информационная иконка
- `pull.png` - стрелка вниз для pull операций
- `push.png` - стрелка вверх для push операций
- `refresh.png` - обновление/синхронизация
- `trash.png` - корзина для удаления

## Архитектурные принципы

### Разделение ответственности
- **UI слой** (`src/ui/`) - только отображение и взаимодействие
- **Бизнес-логика** (`src/app/`) - основная логика приложения
- **Данные** (`src/workspace/`, `src/config/`) - модели данных
- **Внешние операции** (`src/git/`) - взаимодействие с Git
- **Инфраструктура** (`src/logging/`) - вспомогательные сервисы

### Модульность
- Каждый модуль имеет четко определенную область ответственности
- Модули взаимодействуют через публичные API
- Внутренние детали скрыты за модульными границами

### Асинхронность
- Git операции выполняются в фоновых потоках
- Ленивая загрузка workspace'ов для улучшения производительности
- UI остается отзывчивым во время длительных операций
- Результаты передаются через каналы сообщений
- Визуальная обратная связь о состоянии операций

### Типобезопасность
- Использование strong types для предотвращения ошибок
- Перечисления для состояний и сообщений
- Обработка ошибок через Result типы

## Паттерны разработки

### Builder Pattern
- `ButtonBuilder` для гибкой настройки UI элементов
- Fluent API для улучшения читаемости кода

### Message Passing
- Асинхронная коммуникация через `AppMessage`
- Разделение UI и бизнес-логики

### Resource Management
- `PoolGuard` для ограничения ресурсов
- Автоматическое освобождение через Drop trait

### Configuration Management
- Централизованная конфигурация через `ConfigManager`
- Поддержка разных платформ и legacy форматов
- Автоматическое сохранение состояния приложения

### Lazy Loading
- Ленивая загрузка workspace'ов для улучшения производительности
- Загрузка репозиториев только по требованию
- Кэширование состояния загрузки

### Error Handling & Visual Feedback
- Централизованное отслеживание ошибок репозиториев
- Визуальные индикаторы состояния (красный/желтый восклицательный знак)
- Возможность повторных попыток для ошибочных операций

### Smart Git Operations
- Поддержка множественных remotes
- Автоматическое создание tracking веток для remote веток
- Оптимизация операций с избеганием медленных сетевых запросов
